<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mo Bahi - Digital Books</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- App Data and Default Language -->
    <script src="database.js"></script>
    <script src="languages/en.js"></script> 
    
    <!-- All CSS is here -->
    <style>
        :root { --primary-color: #2563eb; --text-primary: #0f172a; --text-secondary: #64748b; --text-muted: #94a3b8; --background: #ffffff; --surface: #f8fafc; --surface-dark: #f1f5f9; --border: #e2e8f0; --border-light: #f1f5f9; --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); --radius: 16px; --radius-lg: 24px; --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); --bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55); --ease-out-quart: cubic-bezier(0.165, 0.84, 0.44, 1); }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #f0f4f8; color: var(--text-primary); line-height: 1.6; overflow-x: hidden; }
        
        .app-wrapper { max-width: 428px; margin: 0 auto; background: var(--background); min-height: 100vh; box-shadow: var(--shadow-xl); overflow: hidden; position: relative; }
        body { padding-top: 70px; padding-bottom: 90px; }

        .desktop-layout { display: none; } /* Initially hidden, controlled by JS */

        @media (min-width: 768px) {
            body { padding: 24px; }
            .app-wrapper { max-width: 768px; min-height: calc(100vh - 48px); border-radius: var(--radius-lg); }
        }

        @media (min-width: 1024px) {
            body { padding: 40px; }
            .mobile-layout { display: none !important; } /* Hide mobile structure on desktop */
            .desktop-layout { display: flex; flex: 1; }
            .app-wrapper { max-width: 1200px; display: flex; flex-direction: column; min-height: calc(100vh - 80px); border-radius: var(--radius-lg); padding:0; }
            .sidebar { width: 300px; background: linear-gradient(180deg, var(--surface) 0%, var(--surface-dark) 100%); padding: 40px 32px; display: flex; flex-direction: column; gap: 40px; }
            .main-content { flex: 1; display: flex; flex-direction: column; background: var(--background); }
            .content-area { flex: 1; padding: 40px; overflow-y: auto; scroll-behavior: smooth; }
            header { border-radius: 0 !important; max-width: none !important; position:relative !important; transform:none !important; left:auto !important; top:auto !important; background: var(--background) !important; padding: 0 40px; height: 90px; border-bottom: 1px solid var(--border); }
        }

        /* All your other beautiful styles (header, nav, buttons, cards etc.) go here. */
        /* They are kept minimal here to focus on the fix. Copy them from your original file. */
        header { position: fixed; top: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 428px; height: 70px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(15px); border-bottom: 1px solid var(--border-light); display: flex; align-items: center; padding: 0 24px; z-index: 100; }
        .header-content { width: 100%; display: flex; align-items: center; }
        .back-btn { background: none; border: none; cursor: pointer; padding: 10px; margin-right: 16px; border-radius: 50%; }
        .header-title { font-size: 22px; font-weight: 700; }
        main, .content-area { padding: 24px; }
        nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 428px; height: 90px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(15px); border-top: 1px solid var(--border-light); z-index: 100; }
        .nav-content { height: 100%; display: flex; align-items: center; justify-content: space-around; }
        .nav-item, .sidebar-nav-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--text-muted); font-size: 12px; font-weight: 600; padding: 10px; border-radius: 12px; transition: var(--transition); }
        .nav-item.active, .sidebar-nav-item.active { color: var(--primary-color); background: rgba(37, 99, 235, 0.1); }
        .sidebar-nav { display: flex; flex-direction: column; gap: 12px; }
        @media (min-width: 1024px) { .sidebar-nav-item { flex-direction: row; font-size: 16px; gap: 20px; padding: 20px 24px; align-items: center; text-align: left; width: 100%; }}
        .nav-icon { margin-bottom: 4px; }
        .svg-icon { width: 24px; height: 24px; fill: currentColor; }
        .hidden { display: none !important; }
        .page-transition { animation: fadeIn 0.5s var(--ease-out-quart); } @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        /* Placeholder for your beautiful styles */
        .book-card { border:1px solid var(--border); border-radius:var(--radius); margin-bottom:20px; padding:15px; cursor:pointer; }
        .slider-section { min-height: 200px; background: var(--surface-dark); border-radius:var(--radius); display:flex; align-items:center; justify-content:center; }
        .categories-section, .new-arrivals-section { margin-top:40px; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.4s ease; backdrop-filter: blur(8px); }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .menu-modal { position: fixed; bottom: 0; left: 0; right: 0; background: var(--background); border-radius: 24px 24px 0 0; padding: 20px; transform: translateY(100%); transition: transform 0.4s var(--ease-out-quart); z-index: 1001; }
        .menu-modal.active { transform: translateY(0); }
        .close-btn { background: #eee; border-radius:50%; padding:10px; border:none; cursor:pointer; float:right; }
        .language-btn { padding: 10px 20px; border: 1px solid #ccc; background: #fff; cursor: pointer; border-radius: 8px; margin: 5px; }
        .language-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <!-- SVG Icons -->
        <svg style="display: none;"><defs><symbol id="home-icon" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></symbol><symbol id="search-icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.5 6.5 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></symbol><symbol id="library-icon" viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></symbol><symbol id="back-arrow-icon" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></symbol></defs></svg>
        
        <!-- Desktop Layout ( initially hidden) -->
        <div class="desktop-layout">
            <div class="sidebar">
                <h1 class="header-title" style="font-size: 28px; padding-bottom: 20px; border-bottom:1px solid var(--border);">Mo Bahi</h1>
                <div class="sidebar-nav" id="sidebarNav"></div>
            </div>
            <div class="main-content">
                <header>
                    <div class="header-content">
                        <button class="back-btn hidden" id="backBtn"><svg class="svg-icon"><use href="#back-arrow-icon"></use></svg></button>
                        <h1 class="header-title" id="headerTitle"></h1>
                    </div>
                </header>
                <div class="content-area" id="app-container"></div>
            </div>
        </div>

        <!-- Mobile/Tablet Layout (initially visible) -->
        <div class="mobile-layout">
            <header>
                <div class="header-content">
                    <button class="back-btn hidden" id="backBtnMobile"><svg class="svg-icon"><use href="#back-arrow-icon"></use></svg></button>
                    <h1 class="header-title" id="headerTitleMobile"></h1>
                </div>
            </header>
            <main id="app-container-mobile"></main>
            <nav><div class="nav-content"><a href="#home" class="nav-item" data-tab="home"><div class="nav-icon"><svg class="svg-icon"><use href="#home-icon"></use></svg></div><span id="navHome"></span></a><a href="#explore" class="nav-item" data-tab="explore"><div class="nav-icon"><svg class="svg-icon"><use href="#search-icon"></use></svg></div><span id="navExplore"></span></a><a href="#library" class="nav-item" data-tab="library"><div class="nav-icon"><svg class="svg-icon"><use href="#library-icon"></use></svg></div><span id="navLibrary"></span></a><a href="#menu" class="nav-item" data-tab="menu"><div class="nav-icon"><svg class="svg-icon"><use href="#menu-icon"></use></svg></div><span id="navMenu"></span></a></div></nav>
        </div>

        <!-- Menu Modal -->
        <div class="modal-overlay" id="menuOverlay">
            <div class="menu-modal" id="menuModal">
                <button class="close-btn" id="closeMenuBtn"><svg class="svg-icon"><use href="#close-icon"></use></svg></button>
                <h2 id="menuTitle">Menu</h2>
                <h3 id="languageTitle">Language</h3>
                <div class="language-grid" id="languageGrid"></div>
                <!-- Other menu items -->
            </div>
        </div>
    </div>

    <script>
    // --- APP STATE ---
    const AppState = { currentRoute: 'home', currentLanguage: 'en', isDesktop: false, swiper: null };
    // --- APP LOGIC ---
    class LayoutManager {
        static init() { this.updateLayout(); window.addEventListener('resize', () => this.updateLayout()); }
        static updateLayout() {
            const isNowDesktop = window.innerWidth >= 1024;
            if (isNowDesktop === AppState.isDesktop && document.querySelector('.app-wrapper').dataset.layoutInitialized) return;

            AppState.isDesktop = isNowDesktop;
            document.querySelector('.desktop-layout').style.display = isNowDesktop ? 'flex' : 'none';
            document.querySelector('.mobile-layout').style.display = isNowDesktop ? 'none' : 'block';
            document.querySelector('.app-wrapper').dataset.layoutInitialized = 'true';
            
            if (isNowDesktop) this.setupDesktopNavigation();
            LanguageManager.updateUI(); // Always update UI text on layout change
            Router.handleRoute(); // Re-render the page in the correct container
        }
        static getContainer() { return AppState.isDesktop ? document.getElementById('app-container') : document.getElementById('app-container-mobile'); }
        static getBackBtn() { return AppState.isDesktop ? document.getElementById('backBtn') : document.getElementById('backBtnMobile'); }
        static getHeaderTitle() { return AppState.isDesktop ? document.getElementById('headerTitle') : document.getElementById('headerTitleMobile'); }
        static setupDesktopNavigation() {
            const nav = document.getElementById('sidebarNav');
            nav.innerHTML = `
                <a href="#home" class="sidebar-nav-item" data-tab="home"><svg class="svg-icon"><use href="#home-icon"></use></svg><span>${lang.home}</span></a>
                <a href="#explore" class="sidebar-nav-item" data-tab="explore"><svg class="svg-icon"><use href="#search-icon"></use></svg><span>${lang.explore}</span></a>
                <a href="#library" class="sidebar-nav-item" data-tab="library"><svg class="svg-icon"><use href="#library-icon"></use></svg><span>${lang.library}</span></a>
                <a href="#menu" class="sidebar-nav-item" data-tab="menu"><svg class="svg-icon"><use href="#menu-icon"></use></svg><span>${lang.menu}</span></a>
            `;
        }
    }
    class LanguageManager {
        static available = { 'en': 'English', 'od': 'ଓଡ଼ିଆ' };
        static init(callback) {
            const savedLang = localStorage.getItem('selectedLanguage') || 'en';
            if (savedLang !== 'en') {
                this.loadScript(savedLang, callback);
            } else {
                AppState.currentLanguage = 'en';
                callback();
            }
        }
        static switch(langCode) {
            if (langCode === AppState.currentLanguage) return;
            this.loadScript(langCode, () => {
                localStorage.setItem('selectedLanguage', langCode);
                this.updateUI();
                Router.handleRoute(); // Re-render page with new language
                MenuModal.hide();
            });
        }
        static loadScript(langCode, callback) {
            const scriptId = 'lang-script';
            document.getElementById(scriptId)?.remove(); // Remove old script if exists
            const script = document.createElement('script');
            script.id = scriptId;
            script.src = `languages/${langCode}.js`;
            script.onload = () => { AppState.currentLanguage = langCode; callback(); };
            script.onerror = () => { console.error(`Failed to load ${langCode}.js`); if(langCode!=='en') this.switch('en'); };
            document.head.appendChild(script);
        }
        static updateUI() {
            Object.entries({ 'navHome': lang.home, 'navExplore': lang.explore, 'navLibrary': lang.library, 'navMenu': lang.menu, 'languageTitle':lang.language, 'menuTitle':lang.menu }).forEach(([id, text]) => {
                const el = document.getElementById(id);
                if (el) el.textContent = text;
            });
            document.getElementById('languageGrid').innerHTML = Object.entries(this.available).map(([code, name]) => 
                `<button class="language-btn ${code === AppState.currentLanguage ? 'active' : ''}" onclick="LanguageManager.switch('${code}')">${name}</button>`
            ).join('');
            if (AppState.isDesktop) LayoutManager.setupDesktopNavigation();
            Router.updateHeader(AppState.currentRoute);
        }
    }
    class Router {
        static init() { window.addEventListener('hashchange', () => this.handleRoute()); this.handleRoute(); }
        static handleRoute() {
            const hash = window.location.hash.slice(1) || 'home';
            const [route, ...params] = hash.split('/');
            if(route === AppState.currentRoute && !params.length) return; // Prevent re-render on same page
            this.navigate(route, params);
        }
        static navigate(route, params) {
            AppState.currentRoute = route;
            this.updateHeader(route);
            this.updateNav(route);
            if (route === 'menu') MenuModal.show(); else this.renderPage(route, params);
        }
        static renderPage(route, params) {
            const container = LayoutManager.getContainer();
            container.innerHTML = '<div class="page-transition">...loading</div>';
            setTimeout(() => { // Simulate loading and allow transition
                 let content = '';
                 if (route === 'home') content = PageRenderer.home();
                 else if (route === 'explore') content = '<h2>Explore Page</h2>';
                 else if (route === 'library') content = '<h2>Library Page</h2>';
                 else if (route === 'book') content = PageRenderer.bookDetails(params[0]);
                 else content = '<h2>Page Not Found</h2>';
                 container.innerHTML = `<div class="page-transition">${content}</div>`;
                 if(route === 'home') this.initSwiper();
            }, 100);
        }
        static updateHeader(route) {
            const titleEl = LayoutManager.getHeaderTitle();
            const backBtn = LayoutManager.getBackBtn();
            if (route === 'home') { titleEl.textContent = lang.appName; backBtn.classList.add('hidden'); }
            else { titleEl.textContent = route.charAt(0).toUpperCase() + route.slice(1); backBtn.classList.remove('hidden'); }
        }
        static updateNav(route) { document.querySelectorAll('.nav-item, .sidebar-nav-item').forEach(i => i.classList.toggle('active', i.dataset.tab === route)); }
        static initSwiper() { if (AppState.swiper) AppState.swiper.destroy(); AppState.swiper = new Swiper('.swiper', { loop: true, autoplay: { delay: 4000 } }); }
    }
    class PageRenderer {
        static home() { return `<div class="slider-section"><div class="swiper"><div class="swiper-wrapper"><div class="swiper-slide">Slide 1 for ${booksDB[0].title}</div></div></div></div><div class="categories-section"><h2>${lang.categories}</h2></div><div class="new-arrivals-section"><h2>${lang.newArrivals}</h2>${booksDB.map(b => this.bookCard(b)).join('')}</div>`; }
        static bookCard(book) { return `<div class="book-card" onclick="window.location.hash='book/${book.id}'"><h3>${book.title}</h3><p>${book.author}</p></div>`; }
        static bookDetails(bookId) {
            const book = booksDB.find(b => b.id === bookId);
            if (!book) return '<h2>Book not found!</h2>';
            return `<div><h1>${book.title}</h1><p>${book.description}</p><button onclick="BookManager.openReader('${book.id}')">Read Now</button></div>`;
        }
    }
    class BookManager {
        static openReader(bookId) {
            const book = booksDB.find(b => b.id === bookId);
            if (!book || !book.fileUrl) { alert('Book file not available.'); return; }
            const readerUrl = `reader.html?file=${encodeURIComponent(book.fileUrl)}&title=${encodeURIComponent(book.title)}`;
            window.open(readerUrl, '_blank');
        }
    }
    class MenuModal {
        static init() { document.getElementById('closeMenuBtn').addEventListener('click', () => this.hide()); document.getElementById('menuOverlay').addEventListener('click', (e) => { if(e.target.id==='menuOverlay') this.hide(); });}
        static show() { document.getElementById('menuOverlay').classList.add('active'); document.getElementById('menuModal').classList.add('active'); }
        static hide() { document.getElementById('menuOverlay').classList.remove('active'); document.getElementById('menuModal').classList.remove('active'); }
    }

    // --- APP INITIALIZATION ---
    function main() {
        console.log("App Main Initialized");
        LayoutManager.init();
        MenuModal.init();
        Router.init();
        // Setup Back buttons
        document.querySelectorAll('.back-btn').forEach(btn => btn.addEventListener('click', () => history.back()));
    }

    document.addEventListener('DOMContentLoaded', () => {
        LanguageManager.init(main); // Start app only after language is loaded
    });
    </script>
</body>
</html>
