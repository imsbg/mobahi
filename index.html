<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mo Bahi - Read Free Books</title>
    <!-- Add your SEO and Open Graph meta tags here -->
    
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #FFFFFF; --primary-text: #111111; --secondary-text: #888888;
            --accent-blue: #3E64FF; --card-bg: #F5F5F5;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--bg-color); color: var(--primary-text); font-family: 'Poppins', sans-serif; padding-bottom: 80px; }
        a { text-decoration: none; color: inherit; }
        .page-view { padding: 16px; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Header */
        .app-header { padding: 16px; font-size: 24px; font-weight: 700; }

        /* Slider */
        .slider-container { width: 100%; border-radius: 16px; overflow: hidden; position: relative; }
        .swiper-slide { cursor: pointer; position: relative; }
        .swiper-slide img { display: block; width: 100%; height: 100%; object-fit: cover; }
        .slider-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); color: white; }
        .slider-title { font-size: 18px; font-weight: 600; }
        .slider-tagline { font-size: 12px; opacity: 0.9; margin-top: 4px; }
        .slider-author { font-size: 12px; opacity: 0.8; margin-top: 8px; }
        .slider-read-btn { position: absolute; bottom: 20px; right: 20px; background-color: var(--accent-blue); color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; }
        .swiper-button-next, .swiper-button-prev { color: white !important; }
        
        /* Section Header */
        .section-header { display: flex; justify-content: space-between; align-items: center; margin: 24px 0 16px 0; }
        .section-title { font-size: 18px; font-weight: 600; }
        .see-all { font-size: 14px; color: var(--accent-blue); font-weight: 500; }

        /* Categories */
        .categories-carousel { display: flex; gap: 20px; overflow-x: auto; scrollbar-width: none; }
        .categories-carousel::-webkit-scrollbar { display: none; }
        .category-item { text-align: center; flex-shrink: 0; }
        .category-icon { width: 64px; height: 64px; border-radius: 50%; overflow: hidden; background-color: var(--card-bg); margin-bottom: 8px; }
        .category-icon img { width: 100%; height: 100%; object-fit: cover; }
        .category-name { font-size: 14px; }

        /* Book Card */
        .book-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
        .book-card { background-color: var(--card-bg); border-radius: 12px; overflow: hidden; position: relative; }
        .book-cover { width: 100%; height: 200px; object-fit: cover; }
        .book-info { padding: 12px; }
        .book-title { font-size: 16px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .book-author { font-size: 12px; color: var(--secondary-text); }
        .book-price-row { display: flex; align-items: baseline; gap: 8px; margin-top: 8px; }
        .book-price { font-size: 18px; font-weight: 700; color: var(--accent-blue); }
        .book-list-price { font-size: 12px; color: var(--secondary-text); text-decoration: line-through; }
        .heart-icon { position: absolute; top: 12px; right: 12px; width: 32px; height: 32px; background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(5px); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }

        /* Book Details Page */
        .details-header { display: flex; align-items: center; padding: 16px; position: sticky; top: 0; background: var(--bg-color); z-index: 10; }
        .back-btn { font-size: 24px; cursor: pointer; }
        .details-header-title { font-size: 18px; font-weight: 600; margin: 0 auto; }
        .details-cover-container { padding: 0 16px; }
        .details-cover { width: 100%; border-radius: 16px; }
        .details-content { padding: 24px 16px; }
        .details-section-header { display: flex; justify-content: space-between; align-items: center; }
        .details-section-title { font-size: 20px; font-weight: 600; }
        .details-section p { color: var(--secondary-text); margin-top: 8px; line-height: 1.7; }
        .details-buy-section { margin-top: 24px; }
        .price-info { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }
        .price-label { color: var(--secondary-text); }
        .details-action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; position: fixed; bottom: 0; left: 0; right: 0; padding: 16px; background-color: var(--bg-color); border-top: 1px solid #eee; }
        .btn { padding: 16px; border-radius: 12px; font-size: 16px; font-weight: 600; text-align: center; cursor: pointer; border: none; }
        .btn-outline { background: transparent; border: 1px solid var(--primary-text); color: var(--primary-text); }
        .btn-solid { background: var(--primary-text); color: var(--bg-color); }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background-color: var(--bg-color); display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #eee; }
        .nav-item { flex: 1; text-align: center; color: var(--secondary-text); }
        .nav-item.active { color: var(--primary-text); }
        .nav-item svg { margin-bottom: 4px; }
    </style>
</head>
<body>
    <main id="app-container">
        <!-- SPA content is injected here -->
    </main>

    <nav class="bottom-nav">
        <a href="#home" class="nav-item active" data-nav="home"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.02 2.84L3.63 7.04C2.73 7.74 2 9.23 2 10.36V17C2 20 4 22 7 22H17C20 22 22 20 22 17V10.36C22 9.23 21.27 7.74 20.37 7.04L14.98 2.84C13.19 1.55 10.81 1.55 9.02 2.84Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg><div>Home</div></a>
        <a href="#explore" class="nav-item" data-nav="explore"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.5 21C16.7467 21 21 16.7467 21 11.5C21 6.25329 16.7467 2 11.5 2C6.25329 2 2 6.25329 2 11.5C2 16.7467 6.25329 21 11.5 21Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 22L20 20" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg><div>Explore</div></a>
        <a href="#library" class="nav-item" data-nav="library"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 14.24V5.24C22 3.24 21 2.24 19 2.24H13.25C13.06 2.24 12.87 2.3 12.7 2.42L10.2 4.42C10.03 4.54 9.84 4.6 9.65 4.6H5C3 4.6 2 5.6 2 7.6V17.6C2 19.6 3 20.6 5 20.6H19C21 20.6 22 19.6 22 17.6V16.24" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/></svg><div>Library</div></a>
        <div id="menu-btn" class="nav-item"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 7H21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M3 12H21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M3 17H21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg><div>Menu</div></div>
    </nav>
    
    <div id="menu-modal" class="menu-modal-overlay" style="display:none;"> <!-- Menu Modal HTML Here --> </div>

    <script src="database.js"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script>
        // --- GLOBAL STATE & UTILITIES ---
        let lang = {};
        const appContainer = document.getElementById('app-container');

        // --- LANGUAGE SYSTEM ---
        async function loadLanguage(langCode) {
            try {
                const response = await fetch(`languages/${langCode}.js`);
                lang = await (new Function(`return (async () => { ${await response.text()}; return lang; })();`))();
                localStorage.setItem('mobahi_lang', langCode);
                document.documentElement.lang = langCode;
                document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.langCode === langCode));
                handleRouteChange();
            } catch (error) {
                console.error(`Failed to load ${langCode}, falling back to English.`, error);
                if (langCode !== 'en') await loadLanguage('en');
            }
        }
        
        // --- RENDER FUNCTIONS ---
        function createBookCard(book) {
            return `
                <a href="#book/${book.id}" class="book-card">
                    <img src="${book.coverUrl}" class="book-cover" alt="${book.title}">
                    <div class="book-info">
                        <div class="book-title">${book.title}</div>
                        <div class="book-author">${book.author}</div>
                        <div class="book-price-row">
                            <div class="book-price">${book.yourPrice}</div>
                            <div class="book-list-price">${book.listPrice}</div>
                        </div>
                    </div>
                </a>`;
        }
        
        function renderHomePage() {
            const sliderBooks = booksDB.filter(b => b.isFeaturedInSlider);
            const newArrivals = booksDB;
            
            appContainer.innerHTML = `
                <div class="app-header">Mo Bahi</div>
                <div class="page-view">
                    <div class="slider-container swiper-container">
                        <div class="swiper-wrapper">
                            ${sliderBooks.map(book => `
                                <div class="swiper-slide" data-id="${book.id}">
                                    <img src="${book.coverUrl}" alt="${book.title}">
                                    <div class="slider-overlay">
                                        <div class="slider-title">${book.title}</div>
                                        <div class="slider-tagline">${book.tagline}</div>
                                        <div class="slider-author">${book.author}</div>
                                    </div>
                                    <div class="slider-read-btn">Read Now</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>

                    <div class="section-header">
                        <div class="section-title">Categories</div>
                        <a href="#" class="see-all">See All</a>
                    </div>
                    <div class="categories-carousel">
                        ${categoriesDB.map(cat => `
                            <div class="category-item">
                                <div class="category-icon"><img src="${cat.iconUrl}" alt="${cat.name}"></div>
                                <div class="category-name">${cat.name}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="section-header">
                        <div class="section-title">New Arrivals</div>
                        <a href="#" class="see-all">See All</a>
                    </div>
                    <div class="book-grid">
                        ${newArrivals.map(createBookCard).join('')}
                    </div>
                </div>`;
            
            new Swiper('.swiper-container', { navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' }, loop: sliderBooks.length > 1 });
            appContainer.querySelectorAll('.swiper-slide').forEach(slide => {
                slide.addEventListener('click', () => window.location.hash = `#book/${slide.dataset.id}`);
            });
        }
        
        function renderBookDetailsPage(bookId) {
            const book = booksDB.find(b => b.id === bookId);
            if (!book) { appContainer.innerHTML = `<div class="page-view"><h1>Book not found</h1></div>`; return; }
            
            document.title = `Mo Bahi - ${book.title}`;
            let library = JSON.parse(localStorage.getItem('mobahi_library')) || [];
            const isSaved = library.includes(bookId);

            appContainer.innerHTML = `
                <div class="details-header">
                    <div class="back-btn" onclick="window.history.back()">←</div>
                    <div class="details-header-title">${book.title}</div>
                </div>
                <div class="page-view">
                    <div class="details-cover-container">
                        <img src="${book.coverUrl}" alt="${book.title}" class="details-cover">
                    </div>
                    <div class="details-content">
                        <div class="details-section">
                            <div class="details-section-header">
                                <div class="details-section-title">Description</div>
                                <div class="heart-icon" data-book-id="${book.id}">${isSaved ? '❤️' : '♡'}</div>
                            </div>
                            <p>${book.description}</p>
                        </div>
                        <div class="details-section">
                            <div class="details-section-title">Category</div>
                            <p>${book.category}</p>
                        </div>
                        <div class="details-buy-section">
                             <div class="details-section-title">Buy the eBook</div>
                             <div class="price-info"><span class="price-label">List Price</span> <span>${book.listPrice}</span></div>
                             <div class="price-info"><span class="price-label">Your price</span> <span class="book-price">${book.yourPrice}</span></div>
                        </div>
                    </div>
                </div>
                <div class="details-action-buttons">
                    <a href="${book.fileUrl}" download class="btn btn-outline">Download</a>
                    <a href="reader.html?file=${encodeURIComponent(book.fileUrl)}" target="_blank" class="btn btn-solid">Read</a>
                </div>`;
            
            appContainer.querySelector('.heart-icon').addEventListener('click', function() {
                let currentLibrary = JSON.parse(localStorage.getItem('mobahi_library')) || [];
                if (currentLibrary.includes(book.id)) {
                    currentLibrary = currentLibrary.filter(id => id !== book.id);
                    this.innerHTML = '♡';
                } else {
                    currentLibrary.push(book.id);
                    this.innerHTML = '❤️';
                }
                localStorage.setItem('mobahi_library', JSON.stringify(currentLibrary));
            });
        }

        // --- ROUTER & OTHER LOGIC --- (Simplified for brevity, use logic from previous answer for search, library, menu)
        const routes = {
            '#home': renderHomePage,
            '#explore': renderHomePage, // For now, explore shows the homepage
            '#library': renderHomePage, // For now, library shows the homepage
        };
        
        function handleRouteChange() {
            const hash = window.location.hash || '#home';
            document.querySelectorAll('.nav-item').forEach(item => item.classList.toggle('active', item.hash === hash));

            const routeHandler = routes[hash];
            if (routeHandler) {
                routeHandler();
            } else if (hash.startsWith('#book/')) {
                renderBookDetailsPage(hash.substring(6));
            } else {
                renderHomePage();
            }
        }
        
        window.addEventListener('hashchange', handleRouteChange);
        document.addEventListener('DOMContentLoaded', async () => {
            await loadLanguage(localStorage.getItem('mobahi_lang') || 'en');
        });
    </script>
</body>
</html>
