<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Details - Mobahi</title>
    <!-- Paste the <style> block from index.html here for consistent styling -->
    <style>/* PASTE CSS HERE */</style>
    <style>
        .details-header { text-align: center; margin-top: 40px; }
        .details-cover { width: 180px; height: 270px; border-radius: 12px; object-fit: cover; box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
        .details-title { font-size: 28px; margin-top: 20px; }
        .action-buttons { display: flex; gap: 10px; justify-content: center; margin: 24px auto; }
        .btn { display: inline-block; padding: 14px 24px; border-radius: 50px; text-decoration: none; font-weight: 600; text-align: center; }
        .btn-primary { background-color: var(--accent-green); color: white; }
        .btn-secondary { background-color: var(--card-bg); color: var(--text-secondary); border: 1px solid var(--text-secondary); }
    </style>
</head>
<body>
    <!-- (HTML structure is similar, but with two buttons now) -->
    <div id="book-content" style="display: none;">
        <!-- ... header ... -->
        <div class="action-buttons">
            <a id="read-now-link" href="#" class="btn btn-primary" data-lang="readNow">Read Now</a>
            <button id="save-library-btn" class="btn btn-secondary" data-lang="saveToLibrary">Save to Library</button>
        </div>
        <!-- ... details sections ... -->
    </div>
    <div id="error-message">...</div>

    <script src="database.js"></script>
    <script>
        let lang = {};
        
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const bookId = urlParams.get('id');
            const book = booksDB.find(b => b.id === bookId);

            if (!book) { /* Show error */ return; }
            
            // --- SAVE TO LIBRARY LOGIC ---
            const saveBtn = document.getElementById('save-library-btn');
            let library = JSON.parse(localStorage.getItem('mobahi_library')) || [];

            function updateButtonState() {
                if (library.includes(bookId)) {
                    saveBtn.textContent = lang.saved || 'Saved âœ”';
                    saveBtn.classList.add('btn-primary');
                    saveBtn.disabled = true;
                } else {
                    saveBtn.textContent = lang.saveToLibrary || 'Save to Library';
                    saveBtn.classList.remove('btn-primary');
                    saveBtn.disabled = false;
                }
            }

            saveBtn.addEventListener('click', () => {
                if (!library.includes(bookId)) {
                    library.push(bookId);
                    localStorage.setItem('mobahi_library', JSON.stringify(library));
                    updateButtonState();
                }
            });
            
            // --- LOAD PAGE ---
            // Populate page content (same as before)
            // ...
            
            const savedLang = localStorage.getItem('mobahi_lang') || 'en';
            await loadLanguage(savedLang, () => {
                // This callback ensures the button text is correct after language loads
                updateButtonState();
            });
        });

        async function loadLanguage(langCode, callback) {
            // Same instant load function as index.html
            // ... then call the callback if it exists
            if (callback) callback();
        }
    </script>
</body>
</html>
